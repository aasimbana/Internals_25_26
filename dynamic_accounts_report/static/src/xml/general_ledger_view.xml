<?xml version="1.0" encoding="UTF-8" ?>
<templates>
    <!-- The gl_template_new template for the GeneralLedger component. -->
    <t t-name="gl_template_new" owl="1">
        <div class="w-100">
            <div class="fin_report">
                <div class="filter_view_gl">
                    <div class="">
                        <h1 style="padding:10px">
                            <t t-if="state.title">
                                <t t-esc="state.title" />
                            </t>
                            <t t-else=" ">
                                <t t-esc="props.action.name" />
                            </t>
                        </h1>
                    </div>
                    <div
                        style="margin-right: 10px; margin-left: 10px;margin-bottom: 15px;display: flex;"
                    >
                        <div class="sub_container_left" style="width:70%;">
                            <div class="report_print">
                                <button
                                    type="button"
                                    class="btn btn-info btn-report-print mr-2"
                                    t-on-click="printPdf"
                                    style="margin-right: 8px;"
                                >
                                    Print (PDF)
                                </button>
                                <button
                                    type="button"
                                    class="btn btn-info btn-report-print mr-2"
                                    t-on-click="print_xlsx"
                                >
                                    Export (XLSX)
                                </button>
                            </div>
                        </div>
                        <div class="sub_container_right">
                            <div class="time_range" style="">
                                <a
                                    type="button"
                                    class="dropdown-toggle"
                                    data-bs-toggle="dropdown"
                                >
                                    <span
                                        class="fa fa-calendar"
                                        title="Dates"
                                        role="img"
                                        aria-label="Dates"
                                    />
                                    Rango de fechas
                                </a>
                                <div class="dropdown-menu" role="menu">
                                    <div class="list-group">
                                        <button
                                            class="report-filter-button"
                                            t-att-data-value="'month'"
                                            type="button"
                                        >
                                            This Month
                                        </button>
                                        <button
                                            class="report-filter-button"
                                            t-att-data-value="'quarter'"
                                            type="button"
                                        >
                                            This Quarter
                                        </button>
                                        <button
                                            class="report-filter-button"
                                            t-att-data-value="'year'"
                                            type="button"
                                        >
                                            This Year
                                        </button>
                                        <div
                                            role="separator"
                                            class="dropdown-divider"
                                        />
                                        <button
                                            class="report-filter-button"
                                            t-att-data-value="'last-month'"
                                            type="button"
                                        >
                                            Last month
                                        </button>
                                        <button
                                            class="report-filter-button"
                                            t-att-data-value="'last-quarter'"
                                            type="button"
                                        >
                                            Last quarter
                                        </button>
                                        <button
                                            class="report-filter-button"
                                            t-att-data-value="'last-year'"
                                            type="button"
                                        >
                                            Last year
                                        </button>
                                        <div
                                            role="separator"
                                            class="dropdown-divider"
                                        />
                                        <label class="" for="date_from">Start
                                            Date :
                                        </label>
                                        <div
                                            class="input-group date"
                                            data-target-input="nearest"
                                        >

                                            <input
                                                type="date"
                                                id="start_date"
                                                t-ref="date_from"
                                                style="border:none;border-bottom: 1px solid #000;padding: 5px;outline: none;"
                                                name="start_date"
                                            />
                                        </div>

                                        <label class="" for="date_to">End Date
                                            :
                                        </label>
                                        <div
                                            class="input-group date"
                                            data-target-input="nearest"
                                        >
                                            <input
                                                type="date"
                                                id="end_date"
                                                t-ref="date_to"
                                                style="border:none;border-bottom: 1px solid #000;padding: 5px;outline: none;"
                                                name="end_date"
                                            />
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="account" style="">
                                <a
                                    type="button"
                                    class="dropdown-toggle"
                                    data-bs-toggle="dropdown"
                                >
                                    <span
                                        class="fa fa-book"
                                        title="Accounts"
                                        role="img"
                                        aria-label="Accounts"
                                    />
                                    Cuentas:
                                    <t t-if="state.selected_account_rec and state.selected_account_rec.length > 0">
                                        <t t-esc="state.selected_account_rec[0].name" />
                                    </t>
                                </a>
                            
                                <div class="dropdown-menu account-dropdown" role="menu">
                                    <!-- Campo de búsqueda -->
                                    <input
                                        type="text"
                                        class="form-control"
                                        placeholder="Buscar Cuenta..."
                                        t-on-input="updateAccountList"
                                    />
                            
                                    <div class="list-group">
                                        <!-- Lista filtrada de cuentas -->
                                        <t
                                            t-foreach="state.filteredAccounts"
                                            t-as="account"
                                            t-key="account.id"
                                        >
                                            <button
                                                class="list-group-item account-filter-button"
                                                t-att-data-value="account.id"
                                                type="button"
                                                t-on-click="selectAccount"
                                            >
                                                <t t-esc="account.name" />
                                                <t t-if="account.code"> (<t t-esc="account.code" />)</t>
                                            </button>
                                        </t>
                                    </div>
                                </div>
                            </div>
                            <div class="analytic" style="">
                                <a
                                    type="button"
                                    class="dropdown-toggle"
                                    data-bs-toggle="dropdown"
                                    style="display:flex;flex-wrap: wrap;align-items: center;justify-content: flex-start;min-width: 105px;"
                                >
                                    <div style="display:content;">
                                        <span>
                                            <span
                                                class="fa fa-book"
                                                title="Analytics"
                                                role="img"
                                            />
                                            Analytic
                                        </span>
                                    </div>
                                    <t t-if="state.selected_analytic_list">:
                                        <t
                                            t-foreach="state.selected_analytic_list"
                                            t-as="Analytic_key"
                                            t-key="Analytic_key_index"
                                        >
                                            <t
                                                t-foreach="state.analytics"
                                                t-as="Analytic"
                                                t-key="Analytic_index"
                                            >
                                                <t
                                                    t-if="Analytic['id'] == Analytic_key"
                                                >
                                                    <span>
                                                        <t t-esc="Analytic['name']" />
                                                    </span>
                                                </t>
                                            </t>
                                            <t
                                                t-if="Analytic_key_index != Object.keys(state.selected_analytic_list).length - 1"
                                            >
                                                ,
                                            </t>
                                        </t>
                                    </t>
                                </a>
                                <div class="dropdown-menu" role="menu">
                                    <div class="list-group">
                                        <t t-if="state.analytics">
                                            <t
                                                t-foreach="state.analytics"
                                                t-as="analytic"
                                                t-key="analytic.id"
                                            >
                                                <button
                                                    class="report-filter-button"
                                                    t-att-data-value="'analytic'"
                                                    t-att-data-id="analytic.id"
                                                    type="button"
                                                >
                                                    <t t-esc="analytic.name" />
                                                </button>
                                            </t>
                                        </t>
                                    </div>
                                </div>
                            </div>


                            <div class="option" style="">
                                <a
                                    type="button"
                                    class="dropdown-toggle"
                                    data-bs-toggle="dropdown"
                                >
                                    <span
                                        class="fa fa-glass"
                                        title="Accounts"
                                        role="img"
                                        aria-label="Dates"
                                    />
                                    Options :Posted Entries ,
                                    <t
                                        t-esc="Object.keys(state.method)[(Object.keys(state.method).length)-1]"
                                    />
                                </a>
                                <div class="dropdown-menu" role="menu">
                                    <div class="list-group">
                                        <button
                                            class="report-filter-button"
                                            t-att-data-value="'draft'"
                                            type="button"
                                        >
                                            Include Draft Entries
                                        </button>
                                        <button
                                            class="report-filter-button"
                                            type="button"
                                            t-ref="unfoldButton"
                                            t-on-click="unfoldAll"
                                        >
                                            Unfold All
                                        </button>
                                        <button
                                            class="report-filter-button"
                                            t-att-data-value="'cash-basis'"
                                            type="button"
                                        >
                                            Cash basis method
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="apply_filter">
                                <button
                                    type="button"
                                    id="apply_filter"
                                    class="btn btn-primary"
                                    t-on-click="applyFilter"
                                >
                                    Aplicar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <br />
            <div>
                <div
                    class="table_view_gl"
                    style="right:20px;height: 650px; overflow-y: scroll;"
                    t-ref="table_view_gl"
                >
                    <div>
                        <div class="table_main_view">
                            <table cellspacing="0" width="100%">
                                <thead>
                                    <tr class="o_heading">
                                        <th colspan="6" />
                                        <th>Date</th>
                                        <th>Communication</th>
                                        <th>Partner</th>
                                        <th>Debit</th>
                                        <th>Credit</th>
                                        <th>Balance</th>
                                    </tr>
                                </thead>
                                
                                <tbody t-ref="tbody">
                                    <t t-if="state.account">
                                        <t t-set="i" t-value="0" />
                                        <t t-foreach="state.account" t-as="account" t-key="account_index">
                                            <t t-set="i" t-value="i + 1" />
                                
                                            <!-- Encabezado por cuenta (caret) -->
                                            <tr class="border-bottom border-dark border-gainsboro">
                                                <th>
                                                    <div
                                                        data-bs-toggle="collapse"
                                                        t-attf-href="#account-{{i}}"
                                                        aria-expanded="false"
                                                        t-attf-aria-controls="account-{{i}}"
                                                        class="ms-3 collapsed"
                                                    >
                                                        <a class="btn header o_heading">
                                                            <span class="toggle-icon">
                                                                <i class="fa fa-caret-down"/>
                                                            </span>
                                                            <t t-if="account != 'false'">
                                                                <t t-esc="account"/>
                                                            </t>
                                                            <t t-else="">
                                                                <span>Unknown Accounts</span>
                                                            </t>
                                                        </a>
                                                    </div>
                                                </th>
                                
                                                <!-- Botón Journal Items -->
                                                <th colspan="5">
                                                    <button
                                                        t-att-data-id="state.account_total[account]['account_id']"
                                                        class="o_journal"
                                                        t-on-click="gotoJournalItem"
                                                    >
                                                        <i class="fa fa-arrow-right"/> Journal Items
                                                    </button>
                                                </th>
                                
                                                <!-- Columnas de totales por cuenta -->
                                                <th/>
                                                <th/>
                                                <th/>
                                
                                                <th>
                                                    <span>
                                                        <t t-if="state.account_total[account]['total_debit']"
                                                           t-esc="state.account_total[account]['currency_id']"/>
                                                        <t t-if="state.account_total[account]['total_debit']"
                                                           t-esc="state.account_total[account]['total_debit']"/>
                                                    </span>
                                                </th>
                                                <th>
                                                    <span>
                                                        <t t-if="state.account_total[account]['total_credit']"
                                                           t-esc="state.account_total[account]['currency_id']"/>
                                                        <t t-if="state.account_total[account]['total_credit']"
                                                           t-esc="state.account_total[account]['total_credit']"/>
                                                    </span>
                                                </th>
                                                <th>
                                                    <span class="fw-bolder">
                                                        <t t-esc="state.account_total[account]['currency_id']"/>
                                                        <t t-esc="(state.account_total[account]['total_debit'] - state.account_total[account]['total_credit']).toFixed(2)"/>
                                                    </span>
                                                </th>
                                            </tr>
                                
                                            <!-- Líneas (movimientos) de la cuenta -->
                                            <t t-if="state.account_data and state.account_data[account] and state.account_data[account].length">
                                                <t t-foreach="state.account_data[account]" t-as="line" t-key="line_index">
                                                    <tr class="border-bottom border-gainsboro collapse" t-attf-id="account-{{i}}">
                                                        <th colspan="6">
                                                            <span style="gap:12px; display:flex; align-items:center;">
                                                                <t t-esc="line.move_name"/>
                                                                <a type="button" class="dropdown-toggle" data-bs-toggle="dropdown"></a>
                                                                <div class="dropdown-menu journals">
                                                                    <button
                                                                        t-att-data-id="line.move_id and line.move_id[0]"
                                                                        type="button"
                                                                        t-on-click="gotoJournalEntry"
                                                                        style="border:none;background-color:inherit;padding:4px 8px;font-size:16px;cursor:pointer;display:inline-block;"
                                                                    >
                                                                        View Journal Entry
                                                                    </button>
                                                                </div>
                                                            </span>
                                                        </th>
                                
                                                        <th><span><t t-esc="line.date"/></span></th>
                                                        <th><span><t t-esc="line.name or ''"/></span></th>
                                                        <th>
                                                            <span>
                                                                <t t-if="line.partner_id" t-esc="line.partner_id[1]"/>
                                                            </span>
                                                        </th>
                                                        <th>
                                                            <span>
                                                                <t t-if="line.debit" t-esc="state.account_total[account]['currency_id']"/>
                                                                <t t-if="line.debit" t-esc="line.debit"/>
                                                            </span>
                                                        </th>
                                                        <th>
                                                            <span>
                                                                <t t-if="line.credit" t-esc="state.account_total[account]['currency_id']"/>
                                                                <t t-if="line.credit" t-esc="line.credit"/>
                                                            </span>
                                                        </th>
                                                        <th/>
                                                    </tr>
                                                </t>
                                            </t>
                                            <t t-else="">
                                                <tr class="collapse" t-attf-id="account-{{i}}">
                                                    <td colspan="12" style="padding:8px 16px; opacity:.7;">
                                                        Sin movimientos para esta cuenta en el rango seleccionado.
                                                    </td>
                                                </tr>
                                            </t>
                                        </t>
                                
                                        <!-- Totales generales -->
                                        <tr>
                                            <th/>
                                            <th colspan="8" class="o_heading">Total</th>
                                            <th class="o_heading">
                                                <t t-esc="state.currency"/><t t-out="state.total_debit"/>
                                            </th>
                                            <th class="o_heading">
                                                <t t-esc="state.currency"/><t t-out="state.total_credit"/>
                                            </th>
                                            <th class="o_heading">
                                                <t t-esc="state.currency"/><t t-out="(state.total_debit - state.total_credit).toFixed(2)"/>
                                            </th>
                                        </tr>
                                    </t>
                                </tbody>
                                
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </t>
</templates>
